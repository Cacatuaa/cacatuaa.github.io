<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heartopia - Guia de Captura</title>
    <style>
        /* Reset para evitar cortes no layout */
        * {
            box-sizing: border-box;
        }

        :root {
            --bg-base: #0f172a;      
            --bg-card: #1e293b;      
            --bg-hover: #334155;     
            --text-main: #f8fafc;    
            --text-muted: #94a3b8;   
            --primary: #3b82f6;      
            --primary-hover: #2563eb;
            --border: #334155;       
            --radius-md: 12px;
            --radius-lg: 16px;
            
            /* Status Colors */
            --status-acquired-bg: rgba(34, 197, 94, 0.08);
            --status-acquired-border: rgba(34, 197, 94, 0.4);
            --status-unavailable-bg: rgba(239, 68, 68, 0.08);
            --status-unavailable-border: rgba(239, 68, 68, 0.4);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-base);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header-container {
            width: 100%;
            max-width: 1000px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn-menu {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 10px 15px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 1.1rem;
            transition: 0.3s;
            white-space: nowrap;
        }

        .btn-menu:hover { background: var(--bg-hover); }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 1000px;
        }

        .search-container {
            width: 100%;
            max-width: 1000px;
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 14px 20px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 16px;
            background: var(--bg-card);
            color: var(--text-main);
            outline: none;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus, input[type="number"]:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        #search-input { max-width: 600px; }

        button, select {
            padding: 12px 20px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            background: var(--bg-card);
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }

        button:hover, select:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
        }

        button.active {
            background-color: var(--primary);
            color: #ffffff;
            border-color: var(--primary);
        }

        .btn-clear {
            background-color: transparent;
            color: var(--text-muted);
            border: 1px dashed var(--border);
        }
        .btn-clear:hover { background-color: #ef4444; color: white; border-color: #ef4444; }

        .btn-action { width: 100%; margin-bottom: 10px; text-align: left; }
        .btn-danger { color: #fca5a5; border-color: #7f1d1d; background: rgba(127, 29, 29, 0.2); }
        .btn-danger:hover { background: #ef4444; color: white; }
        .btn-save { background: var(--primary); color: white; width: 100%; margin-top: 15px; }

        select {
            appearance: none;
            padding-right: 40px;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2394a3b8%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 15px top 50%;
            background-size: 12px auto;
        }

        select option {
            background-color: var(--bg-card);
            color: var(--text-main);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1000px;
        }

        .card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: relative;
        }

        .card:hover { transform: translateY(-3px); }

        .card.acquired {
            background: var(--status-acquired-bg);
            border-color: var(--status-acquired-border);
            opacity: 0.75;
        }
        
        .card.unavailable {
            background: var(--status-unavailable-bg);
            border-color: var(--status-unavailable-border);
            opacity: 0.6;
        }

        .card-lvl-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.5);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .card h3 { margin: 0; color: var(--text-main); font-size: 1.2rem; padding-right: 45px; word-break: break-word; }
        .card .pt-name { margin: 0 0 10px 0; color: #60a5fa; font-size: 0.95rem; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .card p { margin: 0; font-size: 0.95rem; color: var(--text-muted); display: flex; flex-direction: column; gap: 2px; }
        .card strong { color: var(--text-main); }
        .loc-pt { color: #60a5fa; font-size: 0.85rem; }
        
        .info-row {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.95rem;
            margin-top: 4px;
        }

        /* --- SIDEBAR & MODAL --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 99; display: none;
            backdrop-filter: blur(3px);
        }

        .sidebar {
            position: fixed; top: 0; right: -350px; width: 320px; max-width: 85%; height: 100%;
            background: var(--bg-card); z-index: 100;
            box-shadow: -5px 0 15px rgba(0,0,0,0.5);
            transition: 0.3s ease-in-out; padding: 25px;
            display: flex; flex-direction: column; gap: 20px;
            overflow-y: auto;
        }
        .sidebar.open { right: 0; }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 15px; gap: 10px; }
        .sidebar h2 { margin: 0; font-size: 1.3rem; }
        .close-btn { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; padding: 0; box-shadow: none; }
        .close-btn:hover { background: none; transform: scale(1.1); color: #ef4444; }

        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group label { font-size: 0.9rem; color: var(--text-muted); }

        .modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            background: var(--bg-card); width: 95%; max-width: 500px; max-height: 90vh;
            z-index: 101; border-radius: var(--radius-lg); padding: 20px;
            display: none; flex-direction: column; opacity: 0; transition: 0.2s;
            border: 1px solid var(--border); box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }
        .modal.open { display: flex; opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .modal-body { 
            overflow-y: auto; 
            margin-top: 15px; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            padding-right: 5px;
            max-height: 50vh; 
        }
        
        #modal-search { margin-top: 15px; padding: 10px 15px; font-size: 14px; }

        .check-item {
            display: flex; align-items: center; gap: 10px; padding: 10px;
            background: var(--bg-base); border-radius: 8px; border: 1px solid var(--border);
            cursor: pointer;
        }
        .check-item:hover { border-color: var(--primary); }
        .check-item input { width: 18px; height: 18px; accent-color: var(--primary); cursor: pointer; flex-shrink: 0; }
        .check-item span { flex: 1; word-break: break-word; font-size: 0.9rem; }
        .check-item small { color: var(--text-muted); font-size: 0.8rem; white-space: nowrap; }

        /* --- RESPONSIVIDADE --- */
        @media (max-width: 768px) {
            body { padding: 15px; }
            h1 { font-size: 1.8rem; }
            .header-container { flex-direction: column; align-items: stretch; text-align: center; }
            .controls.tabs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
            .controls.filters { flex-direction: column; align-items: stretch; gap: 10px; }
            input[type="text"], button, select { width: 100%; max-width: none; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="overlay" id="overlay" onclick="closeAll()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>üë§ Personagem</h2>
            <button class="close-btn" onclick="toggleSidebar()">‚úñ</button>
        </div>
        
        <div class="form-group">
            <label for="char-level-fish">üé£ N√≠vel de Pesca</label>
            <input type="number" id="char-level-fish" min="1" max="100" placeholder="Sem limite" onchange="saveLevels()">
        </div>

        <div class="form-group">
            <label for="char-level-bug">ü¶ã N√≠vel de Captura (Insetos)</label>
            <input type="number" id="char-level-bug" min="1" max="100" placeholder="Sem limite" onchange="saveLevels()">
        </div>

        <hr style="border-color: var(--border); width: 100%; margin: 10px 0;">

        <div class="form-group">
            <label>Gerenciar Cole√ß√£o (Aba Atual)</label>
            <button class="btn-action" onclick="openModal('acquired')">‚úÖ Marcar Existentes</button>
            <button class="btn-action" onclick="openModal('missing')">‚ùå Marcar Faltantes</button>
        </div>

        <div style="flex-grow: 1;"></div>

        <button class="btn-action btn-danger" onclick="clearHistory()">üóë Limpar Hist√≥rico</button>
    </aside>

    <div class="modal" id="modal">
        <div class="sidebar-header">
            <h2 id="modal-title" style="font-size: 1.2rem;">T√≠tulo</h2>
            <button class="close-btn" onclick="closeModal()">‚úñ</button>
        </div>
        <p id="modal-desc" style="color: var(--text-muted); font-size: 0.85rem; margin: 10px 0 0 0;"></p>
        
        <input type="text" id="modal-search" placeholder="üîç Filtrar na lista..." oninput="filterModal()">

        <div class="modal-body" id="modal-list"></div>
        
        <button class="btn-save" onclick="saveModal()">Salvar Altera√ß√µes</button>
    </div>

    <div class="header-container">
        <h1>Guia Heartopia</h1>
        <button class="btn-menu" onclick="toggleSidebar()">‚öôÔ∏è N√≠veis e Progresso</button>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="üîç Pesquisar nome ou local..." oninput="renderData()">
    </div>

    <div class="controls tabs">
        <button id="btn-peixes" class="active" onclick="setTab('peixes')">üêü Peixes</button>
        <button id="btn-insetos" onclick="setTab('insetos')">ü¶ã Insetos</button>
    </div>

    <div class="controls filters">
        <select id="filter-status" onchange="renderData()">
            <option value="all">üì¶ Todos os Status</option>
            <option value="missing">‚ùå Apenas Faltantes</option>
            <option value="acquired">‚úÖ Apenas Adquiridos</option>
            <option value="unavailable">üîí Indispon√≠vel (N√≠vel Alto)</option>
        </select>

        <select id="filter-weather" onchange="renderData()">
            <option value="all">‚õÖ Qualquer Clima</option>
            <option value="üåû">üåû Ensolarado</option>
            <option value="üåßÔ∏è">üåßÔ∏è Chuvoso</option>
            <option value="üåà">üåà Arco-√≠ris</option>
        </select>

        <select id="filter-time" onchange="renderData()">
            <option value="all">üïí Qualquer Hor√°rio</option>
            <option value="üåÖ">üåÖ Madrugada</option>
            <option value="‚òÄÔ∏è">‚òÄÔ∏è Dia</option>
            <option value="üåá">üåá Entardecer</option>
            <option value="üåô">üåô Noite</option>
        </select>

        <button class="btn-clear" onclick="clearAllFilters()" title="Limpar pesquisa e filtros">‚úñ Limpar</button>
    </div>

    <div id="results" class="grid"></div>

    <script>
        const peixes = [
            { en: "Anglerfish", pt: "Tamboril", locEn: "Sea Fishing", locPt: "Pesca no Mar", w: "üåû, üåßÔ∏è, üåà", t: "üåô, üåÖ, ‚òÄÔ∏è, üåá", lvl: 2 },
            { en: "Arctic Char", pt: "Salvelino", locEn: "Forest Lake", locPt: "Lago Florestal", w: "üåßÔ∏è, üåà", t: "‚òÄÔ∏è, üåá", lvl: 10 },
            { en: "Atlantic Mackerel", pt: "Cavala do Atl√¢ntico", locEn: "Whale Sea", locPt: "Mar da Baleia", w: "üåà, üåû", t: "‚òÄÔ∏è, üåá", lvl: 5 },
            { en: "Blackspot Seabream", pt: "Goraz", locEn: "Zephyr Sea", locPt: "Mar do Vento Brando", w: "üåßÔ∏è, üåà", t: "üåô, üåá", lvl: 7 },
            { en: "Bluefin Tuna", pt: "Atum-rabilho", locEn: "Zephyr Sea", locPt: "Mar do Vento Brando", w: "üåà", t: "üåÖ, ‚òÄÔ∏è", lvl: 9 },
            { en: "Burbot", pt: "Peixe-bolha", locEn: "Tranquil River", locPt: "Rio Sereno", w: "üåû, üåßÔ∏è, üåà", t: "‚òÄÔ∏è, üåá", lvl: 4 },
            { en: "European Eel", pt: "Enguia Europeia", locEn: "Old Sea", locPt: "Mar Antigo", w: "üåà", t: "üåÖ, ‚òÄÔ∏è, üåá", lvl: 7 },
            { en: "Giant Oarfish", pt: "Peixe-remo Gigante", locEn: "Sea Fishing", locPt: "Pesca no Mar", w: "üåû, üåßÔ∏è, üåà", t: "üåÖ, ‚òÄÔ∏è", lvl: 7 },
            { en: "Golden King Crab", pt: "Caranguejo-real Dourado", locEn: "Sea Fishing", locPt: "Pesca no Mar", w: "üåà", t: "üåô, üåÖ, ‚òÄÔ∏è, üåá", lvl: 8 },
            { en: "King Crab", pt: "Caranguejo-real", locEn: "Whale Sea", locPt: "Mar da Baleia", w: "üåà", t: "üåÖ, ‚òÄÔ∏è, üåá", lvl: 8 },
            { en: "Northern Pike", pt: "L√∫cio do Norte", locEn: "Suburban Lake", locPt: "Lago Suburbano", w: "üåßÔ∏è, üåà", t: "üåô, üåá", lvl: 9 },
            { en: "Ocean Sunfish", pt: "Peixe-lua Oce√¢nico", locEn: "East Sea", locPt: "Mar Leste", w: "üåû, üåßÔ∏è, üåà", t: "üåô, üåÖ", lvl: 9 },
            { en: "Shortfin Mako Shark", pt: "Tubar√£o-mako de Barbatana Curta", locEn: "Sea Fishing", locPt: "Pesca no Mar", w: "üåà", t: "üåÖ, ‚òÄÔ∏è", lvl: 10 },
            { en: "Smooth Hammerhead", pt: "Tubar√£o-martelo Liso", locEn: "Old Sea", locPt: "Mar Antigo", w: "üåà", t: "üåô, üåá", lvl: 10 },
            { en: "Swordfish", pt: "Peixe-espada", locEn: "Whale Sea", locPt: "Mar da Baleia", w: "üåà", t: "üåÖ, ‚òÄÔ∏è", lvl: 10 },
            { en: "Wels Catfish", pt: "Siluro Europeu", locEn: "Meadow Lake", locPt: "Lago da Campina", w: "üåû, üåà", t: "üåô, üåá", lvl: 10 }
        ];

        const insetos = [
            { en: "Alpine Longhorn Beetle", pt: "Besouro Longicorne Alpino", locEn: "Forest Island", locPt: "Ilha Florestal", w: "üåà", t: "üåô, üåÖ, ‚òÄÔ∏è, üåá", lvl: 5 },
            { en: "Amethyst Flower Beetle", pt: "Besouro de Flor Ametista", locEn: "Home (Rocks)", locPt: "Fal√©sia Rochosa", w: "üåßÔ∏è, üåà", t: "üåô, üåÖ, ‚òÄÔ∏è, üåá", lvl: 2 },
            { en: "Ant", pt: "Formiga", locEn: "Fishing Village", locPt: "Vila dos Pescadores", w: "üåû, üåßÔ∏è, üåà", t: "üåô, üåÖ, ‚òÄÔ∏è, üåá", lvl: 3 },
            { en: "Bagworm Moth", pt: "Tra√ßa Bagworm", locEn: "Forest (Deer Tower)", locPt: "Torre do Cervo", w: "üåû, üåà", t: "üåô, üåá", lvl: 10 },
            { en: "Blue Morpho", pt: "Borboleta Morfo Azul", locEn: "Forest", locPt: "Floresta", w: "üåû, üåà", t: "üåÖ, ‚òÄÔ∏è, üåá", lvl: 7 },
            { en: "Comet Moth", pt: "Mariposa Cometa", locEn: "Suburbs", locPt: "Sub√∫rbio", w: "üåû, üåà", t: "üåá, üåô", lvl: 8 },
            { en: "Conehead Mantis", pt: "Louva-a-deus Cabe√ßa de Cone", locEn: "Onsen Mountain", locPt: "Monte Termal", w: "üåßÔ∏è, üåà", t: "‚òÄÔ∏è, üåá", lvl: 9 },
            { en: "Elegant Flower Beetle", pt: "Besouro de Flor Elegante", locEn: "Flower Field", locPt: "Campo Floral", w: "üåßÔ∏è, üåà", t: "üåÖ, ‚òÄÔ∏è", lvl: 7 },
            { en: "Giant Asian Mantis", pt: "Louva-a-deus Gigante Asi√°tico", locEn: "Onsen Mountain", locPt: "Monte Termal", w: "üåû, üåà", t: "üåô, üåÖ, ‚òÄÔ∏è, üåá", lvl: 5 },
            { en: "Golden Jewel Scarab", pt: "Escaravelho Joia Dourado", locEn: "Forest", locPt: "Floresta", w: "üåû, üåà", t: "‚òÄÔ∏è, üåá", lvl: 7 },
            { en: "Golden Stag Beetle", pt: "Besouro Veado Dourado", locEn: "Forest", locPt: "Floresta", w: "üåßÔ∏è, üåà", t: "üåô, üåá", lvl: 9 },
            { en: "Hercules Beetle", pt: "Besouro H√©rcules", locEn: "Onsen Mountain", locPt: "Monte Termal", w: "üåû, üåà", t: "‚òÄÔ∏è, üåá", lvl: 10 },
            { en: "Morpho Helena", pt: "Borboleta Morpho Helena", locEn: "Flower Field", locPt: "Campo Floral", w: "üåà", t: "üåÖ, ‚òÄÔ∏è", lvl: 10 },
            { en: "Rainbow Stag Beetle", pt: "Besouro Veado Arco-√çris", locEn: "Bait Event", locPt: "Evento de Isca", w: "üåû, üåßÔ∏è, üåà", t: "üåô, üåÖ, ‚òÄÔ∏è, üåá", lvl: 9 },
            { en: "Sunset Morpho", pt: "Borboleta Morpho do P√¥r do Sol", locEn: "Forest (Deer Tower)", locPt: "Torre do Cervo", w: "üåà", t: "üåÖ, ‚òÄÔ∏è", lvl: 10 }
        ];

        let currentTab = 'peixes';
        let fishLevel = null;
        let bugLevel = null;
        let caughtItems = []; 
        let currentModalMode = '';

        // --- INICIALIZA√á√ÉO E LOCAL STORAGE ---
        function init() {
            const savedFishLevel = localStorage.getItem('ht_fishLevel');
            const savedBugLevel = localStorage.getItem('ht_bugLevel');
            const savedCaught = localStorage.getItem('ht_caughtItems');
            
            if (savedFishLevel) {
                document.getElementById('char-level-fish').value = savedFishLevel;
                fishLevel = parseInt(savedFishLevel);
            }
            if (savedBugLevel) {
                document.getElementById('char-level-bug').value = savedBugLevel;
                bugLevel = parseInt(savedBugLevel);
            }
            if (savedCaught) {
                caughtItems = JSON.parse(savedCaught);
            }
            renderData();
        }

        function saveLevels() {
            const fVal = document.getElementById('char-level-fish').value;
            const bVal = document.getElementById('char-level-bug').value;
            
            fishLevel = fVal ? parseInt(fVal) : null;
            bugLevel = bVal ? parseInt(bVal) : null;

            if(fVal) localStorage.setItem('ht_fishLevel', fVal); else localStorage.removeItem('ht_fishLevel');
            if(bVal) localStorage.setItem('ht_bugLevel', bVal); else localStorage.removeItem('ht_bugLevel');
            
            renderData();
        }

        function saveCaughtData() {
            localStorage.setItem('ht_caughtItems', JSON.stringify(caughtItems));
        }

        function clearHistory() {
            if(confirm("Tem certeza que deseja apagar todo o seu progresso?")) {
                localStorage.removeItem('ht_fishLevel');
                localStorage.removeItem('ht_bugLevel');
                localStorage.removeItem('ht_caughtItems');
                
                fishLevel = null;
                bugLevel = null;
                caughtItems = [];
                
                document.getElementById('char-level-fish').value = '';
                document.getElementById('char-level-bug').value = '';
                
                toggleSidebar();
                renderData();
            }
        }

        // --- INTERFACE (UI) ---
        function setTab(tab) {
            currentTab = tab;
            document.getElementById('btn-peixes').classList.toggle('active', tab === 'peixes');
            document.getElementById('btn-insetos').classList.toggle('active', tab === 'insetos');
            document.getElementById('search-input').value = '';
            renderData();
        }

        function clearAllFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('filter-weather').value = 'all';
            document.getElementById('filter-time').value = 'all';
            document.getElementById('filter-status').value = 'all';
            renderData();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const isOpen = sidebar.classList.contains('open');
            
            if (isOpen) {
                sidebar.classList.remove('open');
                overlay.style.display = 'none';
            } else {
                sidebar.classList.add('open');
                overlay.style.display = 'block';
            }
        }

        function closeAll() {
            document.getElementById('sidebar').classList.remove('open');
            closeModal();
            document.getElementById('overlay').style.display = 'none';
        }

        // --- MODAL DE SELE√á√ÉO ---
        function openModal(mode) {
            currentModalMode = mode;
            const modal = document.getElementById('modal');
            const listContainer = document.getElementById('modal-list');
            const dataToRender = currentTab === 'peixes' ? peixes : insetos;
            const categoryName = currentTab === 'peixes' ? 'peixes' : 'insetos';
            
            // Reseta a busca do modal
            document.getElementById('modal-search').value = '';
            
            listContainer.innerHTML = '';
            
            if (mode === 'acquired') {
                document.getElementById('modal-title').innerText = "Marcar Adquiridos";
                document.getElementById('modal-desc').innerText = "Selecione na lista abaixo o que voc√™ J√Å PEGOU.";
                
                dataToRender.forEach(item => {
                    const isCaught = caughtItems.includes(item.en);
                    listContainer.innerHTML += `
                        <label class="check-item">
                            <input type="checkbox" value="${item.en}" ${isCaught ? 'checked' : ''}>
                            <span>${item.en} <small>(${item.pt})</small></span>
                            <small>Nv. ${item.lvl}</small>
                        </label>
                    `;
                });
            } else if (mode === 'missing') {
                document.getElementById('modal-title').innerText = "Marcar Faltantes";
                document.getElementById('modal-desc').innerText = "Selecione o que FALTA. Ao salvar, todos os outros itens desta aba (mesmo os ocultos na busca) ser√£o marcados como pegos.";
                
                dataToRender.forEach(item => {
                    const isCaught = caughtItems.includes(item.en);
                    listContainer.innerHTML += `
                        <label class="check-item">
                            <input type="checkbox" value="${item.en}" ${!isCaught ? 'checked' : ''}>
                            <span>${item.en} <small>(${item.pt})</small></span>
                            <small>Nv. ${item.lvl}</small>
                        </label>
                    `;
                });
            }

            modal.classList.add('open');
        }

        function filterModal() {
            const query = document.getElementById('modal-search').value.toLowerCase();
            const items = document.querySelectorAll('#modal-list .check-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(query)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('open');
        }

        function saveModal() {
            const checkboxes = document.querySelectorAll('#modal-list input[type="checkbox"]');

            if (currentModalMode === 'acquired') {
                checkboxes.forEach(cb => {
                    const index = caughtItems.indexOf(cb.value);
                    if (cb.checked && index === -1) caughtItems.push(cb.value);
                    else if (!cb.checked && index > -1) caughtItems.splice(index, 1);
                });
            } 
            else if (currentModalMode === 'missing') {
                checkboxes.forEach(cb => {
                    const itemName = cb.value;
                    const index = caughtItems.indexOf(itemName);
                    
                    if (cb.checked) {
                        if (index > -1) caughtItems.splice(index, 1);
                    } else {
                        if (index === -1) caughtItems.push(itemName);
                    }
                });
            }

            saveCaughtData();
            closeAll();
            renderData();
        }

        // --- RENDERIZA√á√ÉO E FILTROS ---
        function getItemStatus(item) {
            if (caughtItems.includes(item.en)) return 3; // Adquirido
            
            // Verifica o n√≠vel respectivo √† aba
            const currentLevel = currentTab === 'peixes' ? fishLevel : bugLevel;
            
            // Se o n√≠vel n√£o √© nulo e o item √© maior que o n√≠vel, bloqueia
            if (currentLevel !== null && item.lvl > currentLevel) return 2; // Indispon√≠vel
            
            return 1; // Faltante/Dispon√≠vel
        }

        function renderData() {
            const searchQuery = document.getElementById('search-input').value.toLowerCase();
            const weatherFilter = document.getElementById('filter-weather').value;
            const timeFilter = document.getElementById('filter-time').value;
            const statusFilter = document.getElementById('filter-status').value;
            const resultsContainer = document.getElementById('results');
            
            const dataToRender = currentTab === 'peixes' ? peixes : insetos;
            
            // 1. Filtrar
            let filteredData = dataToRender.filter(item => {
                const matchSearch = item.en.toLowerCase().includes(searchQuery) || 
                                    item.pt.toLowerCase().includes(searchQuery) ||
                                    item.locEn.toLowerCase().includes(searchQuery) ||
                                    item.locPt.toLowerCase().includes(searchQuery);
                                    
                const matchWeather = weatherFilter === 'all' || item.w.includes(weatherFilter);
                const matchTime = timeFilter === 'all' || item.t.includes(timeFilter);
                
                const statusNum = getItemStatus(item);
                let matchStatus = true;
                if (statusFilter === 'missing') matchStatus = (statusNum === 1);
                if (statusFilter === 'unavailable') matchStatus = (statusNum === 2);
                if (statusFilter === 'acquired') matchStatus = (statusNum === 3);

                return matchSearch && matchWeather && matchTime && matchStatus;
            });

            // 2. Ordenar
            filteredData.sort((a, b) => {
                const statusA = getItemStatus(a);
                const statusB = getItemStatus(b);
                
                if (statusA !== statusB) return statusA - statusB;
                return a.lvl - b.lvl; 
            });

            // 3. Renderizar
            resultsContainer.innerHTML = '';

            if (filteredData.length === 0) {
                resultsContainer.innerHTML = '<div class="empty-state">Nenhum resultado encontrado para esses filtros.</div>';
                return;
            }

            filteredData.forEach(item => {
                const statusNum = getItemStatus(item);
                let cardClass = 'card';
                let statusIcon = '';
                
                if (statusNum === 2) {
                    cardClass += ' unavailable';
                    statusIcon = 'üîí ';
                } else if (statusNum === 3) {
                    cardClass += ' acquired';
                    statusIcon = '‚úÖ ';
                }

                const card = document.createElement('div');
                card.className = cardClass;
                card.innerHTML = `
                    <div class="card-lvl-badge">Nv. ${item.lvl}</div>
                    <h3>${statusIcon}${item.en}</h3>
                    <div class="pt-name">${item.pt}</div>
                    <p>
                        <span>üìç <strong>Local:</strong> ${item.locEn}</span>
                        <span class="loc-pt">(${item.locPt})</span>
                    </p>
                    <div class="info-row">
                        <span title="Clima">‚òÅÔ∏è ${item.w}</span>
                    </div>
                    <div class="info-row">
                        <span title="Hor√°rio">üïí ${item.t}</span>
                    </div>
                `;
                resultsContainer.appendChild(card);
            });
        }

        // Inicia a aplica√ß√£o
        init();
    </script>
</body>
</html>
